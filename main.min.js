phina.globalize();var BG_COLOR="gray",FRIEND_COLOR="lime",TARGET_COLOR="white",TARGET_SIZE=128,TARGET_OFFSET_Y=-4,NUMBER_SIZE=TARGET_SIZE/2,NUMBER_PER_LINE=5,NUMBER_OFFSET_Y=5,NUMBER_MOVE_SPEED=200,HISTRY_SIZE=2*NUMBER_SIZE/3,LOCATE_X=160,PUSH_ANIM={tweens:[["to",{scaleX:.8,scaleY:.8},50],["to",{scaleX:1,scaleY:1},50]]},APPEAR_ANIM={tweens:[["to",{scaleX:2,scaleY:2},150]]},DISAPPEAR_ANIM={tweens:[["by",{y:100,alpha:-1},200]]};phina.define("MainScene",{superClass:"CanvasScene",init:function(){this.superInit(),this.backgroundColor=BG_COLOR;var e=RectangleShape({cornerRadius:8,width:this.gridX.span(12),height:this.gridY.span(5),fill:null,stroke:"yellow"}).addChildTo(this);e.x=this.gridX.center(),e.y=this.gridY.center(1),this.targetGroup=CanvasElement().addChildTo(this),this.numberGroup=CanvasElement().addChildTo(this),this.judgeGroup=CanvasElement().addChildTo(this),this.historyGroup=CanvasElement().addChildTo(this);var t=this.gridX.span(12);this.targetGrid=Grid(t,3),this.numberGrid=Grid(t,5),this.step=100,this.stepLabel=Label({text:"STEP： "+this.step,fontSize:64,fill:FRIEND_COLOR}).addChildTo(this),this.stepLabel.x=this.gridX.center(),this.stepLabel.y=this.gridY.span(1),this.deadNumbers=[],this.setTagets(),this.setNumbers()},setTagets:function(){this.targetGroup.children.clear();var e=Array.range(0,10).shuffle(),t=this;3..times(function(i){var n=Target(e.pop()).addChildTo(t.targetGroup);n.x=t.targetGrid.span(i)+LOCATE_X,n.y=t.gridY.center(TARGET_OFFSET_Y)})},setTargetsEmpty:function(){this.targetGroup.children.each(function(e){e.isEmpty=!0})},setNumbers:function(){this.numberGroup.children.clear(),this.judgeGroup.children.clear();var e=Array.range(0,10),t=this;e.each(function(e,i){var n=i%NUMBER_PER_LINE,s=Math.floor(i/NUMBER_PER_LINE),r=Num(e).addChildTo(t.numberGroup);r.x=t.numberGrid.span(n)+LOCATE_X-32,r.y=t.numberGrid.span(s)+t.gridY.center(NUMBER_OFFSET_Y),r.onpointend=function(){t.moveNumber(r)};var a=t.deadNumbers.contains(e,0);a&&(r.setInteractive(!1),r.alpha=.2)})},moveNumber:function(e){var t=this,i=!1;this.setNumberEnable(!1),this.targetGroup.children.each(function(n){!i&&n.isEmpty&&(i=!0,e.tweener.clear().fromJSON(PUSH_ANIM).set({x:n.x,y:n.y}).fromJSON(APPEAR_ANIM).call(function(){t.afterNumMove(e,n)}))})},afterNumMove:function(e,t){t.isEmpty=!1,e.addChildTo(this.judgeGroup),3===this.judgeGroup.children.length?this.checkEatBite():this.setNumberEnable(!0)},checkEatBite:function(){var e=0,t=0,i=this;this.targetGroup.children.each(function(n){i.judgeGroup.children.each(function(i){n.num===i.num&&(n.x===i.x&&n.y===i.y?e++:t++)})});var n="";this.judgeGroup.children.each(function(e){n+=e.num});var s="{0} ： {1} EAT - {2} BITE".format(n,e,t);History(s).addChildTo(this.historyGroup);this.historyGroup.children.length>5&&this.historyGroup.children.first.remove(),this.historyGroup.children.each(function(e,t){e.x=i.gridX.center(),e.y=i.gridY.center(3-t)}),this.afterJudge(e,t)},afterJudge:function(e,t){var i=this;if(0===e&&0===t&&this.judgeGroup.children.each(function(e){i.deadNumbers.push(e.num)}),3===e){var n=phina.util.Flow(function(e,t){var n=3;i.judgeGroup.children.each(function(t){t.fill=FRIEND_COLOR,t.label.fill="white",t.tweener.clear().to({scaleX:2.2,scaleY:2.2},400).to({scaleX:2,scaleY:2},400).call(function(){n--,0===n&&e("done")})})});n.then(function(e){i.tweener.clear().wait(1e3).call(function(){i.exit({score:i.step,message:"<Eat And Bite> Made in phina.js.\nscore:{score}.",hashtags:"phina_js,game,javascript"})})})}else{var s=phina.util.Flow(function(e,t){var n=3;i.judgeGroup.children.each(function(t){t.tweener.clear().to({scaleX:2.2,scaleY:2.2},50).to({scaleX:2,scaleY:2},50).fromJSON(DISAPPEAR_ANIM).call(function(){n--,0===n&&e("done")})})});s.then(function(e){i.step--,i.step<0&&(i.step=0),i.stepLabel.text="STEP： "+i.step,i.setNumbers(),i.setTargetsEmpty()})}},setNumberEnable:function(e){this.numberGroup.children.each(function(t){t.setInteractive(e)})}}),phina.define("Target",{superClass:"RectangleShape",init:function(e){this.superInit({cornerRadius:8,width:TARGET_SIZE,height:TARGET_SIZE,fill:null,stroke:TARGET_COLOR}),this.num=e,this.isEmpty=!0,this.label=Label({text:"？",fontSize:TARGET_SIZE,fill:TARGET_COLOR}).addChildTo(this)}}),phina.define("Num",{superClass:"RectangleShape",init:function(e){this.superInit({cornerRadius:8,width:NUMBER_SIZE,height:NUMBER_SIZE,fill:BG_COLOR,stroke:FRIEND_COLOR}),this.num=e,this.label=Label({text:this.num+"",fontSize:NUMBER_SIZE,fill:FRIEND_COLOR}).addChildTo(this),this.setInteractive(!0)}}),phina.define("History",{superClass:"Label",init:function(e){this.superInit({text:e,fontSize:HISTRY_SIZE,fill:"yellow"})}}),phina.main(function(){var e=GameApp({title:"Eat And Bite",startLabel:"title"});document.body.appendChild(e.domElement),e.run()});